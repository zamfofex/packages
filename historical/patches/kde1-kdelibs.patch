--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -0,1 +0,1 @@ install(FILES
-    DESTINATION ${CMAKE_ROOT}/Modules)
+    DESTINATION ${CMAKE_INSTALL_PREFIX}/share/cmake/KDE1/Modules)

--- a/cmake/KDE1InstallDirs.cmake.in
+++ b/cmake/KDE1InstallDirs.cmake.in
@@ -0,18 +0,19 @@
+include(GNUInstallDirs)
-set(KDE1_PREFIX "@KDE1_PREFIX@")
-set(KDE1_APPSDIR "@KDE1_APPSDIR@")
-set(KDE1_BINDIR "@KDE1_BINDIR@")
-set(KDE1_CGIDIR "@KDE1_CGIDIR@")
-set(KDE1_CONFDIR "@KDE1_CONFDIR@")
-set(KDE1_DATADIR "@KDE1_DATADIR@")
-set(KDE1_HTMLDIR "@KDE1_HTMLDIR@")
-set(KDE1_ICONDIR "@KDE1_ICONDIR@")
+set(KDE1_PREFIX "${CMAKE_INSTALL_PREFIX}")
+set(KDE1_APPSDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/applnk")
+set(KDE1_BINDIR "${CMAKE_INSTALL_FULL_BINDIR}")
+set(KDE1_CGIDIR "${CMAKE_INSTALL_PREFIX}/cgi-bin")
+set(KDE1_CONFDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/config")
+set(KDE1_DATADIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/apps")
+set(KDE1_HTMLDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/doc/kde1/HTML")
+set(KDE1_ICONDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/icons")
 set(KDE1_INCLUDES "@KDE1_INCLUDES@")
 set(KDE1_LIBRARIES "@KDE1_LIBRARIES@")
-set(KDE1_LIBDIR "@KDE1_LIBDIR@")
-set(KDE1_LOCALE "@KDE1_LOCALE@")
-set(KDE1_MIMEDIR "@KDE1_MIMEDIR@")
-set(KDE1_MINIDIR "@KDE1_MINIDIR@")
-set(KDE1_PARTSDIR "@KDE1_PARTSDIR@")
-set(KDE1_SOUNDDIR "@KDE1_SOUNDDIR@")
-set(KDE1_TOOLBARDIR "@KDE1_TOOLBARDIR@")
-set(KDE1_WALLPAPERDIR "@KDE1_WALLPAPERDIR@")
+set(KDE1_LIBDIR "${CMAKE_INSTALL_FULL_LIBDIR}")
+set(KDE1_LOCALE "${CMAKE_INSTALL_FULL_DATAROOTDIR}/locale/kde1/")
+set(KDE1_MIMEDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/mimelnk")
+set(KDE1_MINIDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/icons/mini")
+set(KDE1_PARTSDIR "${CMAKE_INSTALL_PREFIX}/parts")
+set(KDE1_SOUNDDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/sounds")
+set(KDE1_TOOLBARDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/toolbar")
+set(KDE1_WALLPAPERDIR "${CMAKE_INSTALL_FULL_DATAROOTDIR}/wallpapers")

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,3 @@
-KCharsets* KApplication::pCharsets = 0L;
+#define XDG_DATA_DIRS QString(xdg_data_dirs)
+char *xdg_data_dirs = strdup(getenv("XDG_DATA_DIRS"));
+KCharsets* KApplication::pCharsets = 0L;

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_APPSDIR;
+      dir = XDG_DATA_DIRS.append("/applnk");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_DATADIR;
+      dir = XDG_DATA_DIRS.append("/apps");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_HTMLDIR;
+      dir = XDG_DATA_DIRS.append("/doc/kde1/HTML");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_ICONDIR;
+      dir = XDG_DATA_DIRS.append("/icons");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-	dir = KDE_LOCALE;
+	dir = XDG_DATA_DIRS.append("/locale/kde1");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_MIMEDIR;
+      dir = XDG_DATA_DIRS.append("/mimelnk");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_SOUNDDIR;
+      dir = XDG_DATA_DIRS.append("/sounds");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_TOOLBARDIR;
+      dir = XDG_DATA_DIRS.append("/toolbar");

--- a/kdecore/kapp.cpp
+++ b/kdecore/kapp.cpp
@@ -0,1 +0,1 @@
-      dir = KDE_WALLPAPERDIR;
+      dir = XDG_DATA_DIRS.append("/wallpapers");
